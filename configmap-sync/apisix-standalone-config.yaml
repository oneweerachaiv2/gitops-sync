# APISIX Standalone Configuration (apisix.yaml)
# This ConfigMap is mounted into APISIX pod as /usr/local/apisix/conf/apisix.yaml
# APISIX reads this file directly in standalone mode (no etcd required)
apiVersion: v1
kind: ConfigMap
metadata:
  name: apisix-standalone-config
  namespace: apisix
  labels:
    app.kubernetes.io/name: apisix-config
    app.kubernetes.io/managed-by: argocd
data:
  apisix.yaml: |
    # APISIX Standalone Declarative Configuration
    # This file is auto-synced by ArgoCD GitOps

    upstreams:
      - id: httpbin-upstream
        name: httpbin-upstream
        type: roundrobin
        nodes:
          - host: httpbin.httpbin.svc.cluster.local
            port: 8000
            weight: 1
        timeout:
          connect: 5
          send: 15
          read: 15
        retries: 3

    routes:
      - id: gitops-v1-users
        name: "Users API V1 - GitOps ConfigMap"
        uri: /api/v1/users*
        methods:
          - GET
          - POST
        upstream_id: httpbin-upstream
        plugins:
          response-rewrite:
            headers:
              set:
                X-API-Version: "1"
                X-Environment: development
                X-Deployed-By: ConfigMap-GitOps

      - id: gitops-v2-users
        name: "Users API V2 - GitOps ConfigMap"
        uri: /api/v2/users*
        methods:
          - GET
          - POST
          - PUT
          - PATCH
          - DELETE
        upstream_id: httpbin-upstream
        plugins:
          response-rewrite:
            headers:
              set:
                X-API-Version: "2"
                X-Environment: development
                X-Deployed-By: ConfigMap-GitOps

      - id: gitops-v3-users
        name: "Users API V3 - GitOps ConfigMap Beta"
        uri: /api/v3/users*
        methods:
          - GET
          - POST
          - PUT
          - PATCH
          - DELETE
        upstream_id: httpbin-upstream
        plugins:
          response-rewrite:
            headers:
              set:
                X-API-Version: "3"
                X-API-Beta: "true"
                X-Environment: development
                X-Deployed-By: ConfigMap-GitOps

      - id: gitops-v4-users
        name: "Users API V4 - GitOps ConfigMap Experimental"
        uri: /api/v4/users*
        methods:
          - GET
          - POST
          - PUT
          - PATCH
          - DELETE
        upstream_id: httpbin-upstream
        plugins:
          response-rewrite:
            headers:
              set:
                X-API-Version: "4"
                X-API-Experimental: "true"
                X-Environment: development
                X-Deployed-By: ConfigMap-GitOps
    #END

